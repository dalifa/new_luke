// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User{
  id             String     @id @default(auto()) @map("_id") @db.ObjectId
  name           String?
  email          String?    @unique
  emailVerified  DateTime?
  image          String?
  password       String?
  //
  accounts       Account[]
  //
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}
// selon Auth.JS site officiel au 03/01/2024
model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.String
  access_token      String? @db.String
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.String
  session_state     String?

  @@unique([provider, providerAccountId])
}
//
// reponses aux questions pour l'engagement
model Response{
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  googleEmail      String? // le connecté que l'on questionne
  // croyez vous qu'il n'y a de salut qu'au nom de jésus ?
  response1        Boolean  @default(false)
  // jesus à dit: luke 6:38 dites vous amen ?
  response2        Boolean  @default(false)
  // vous engagez vous à donner au moins 5€ / mois à un enfant de Dieu ?
  response3        Boolean  @default(false)
  // avez vous paylib
  response4        Boolean  @default(false)
  //
  response5        Boolean  @default(false)

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}
//
model Profile {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  googleEmail          String?   
  usercodepin          Int      @unique @default(1000)
  credit               Int      @default(0)
  jackpot              Int      @default(0)
  jackpotCents         Int      @default(0) // en cents x 100
  //
  username             String 
  phone                String
  firstname            String    
  lastname             String    
  city                 String    
  countryId            String   @db.ObjectId
  country              Country? @relation(fields: [countryId], references: [id], onDelete: Cascade)    
  bio                  String    
  // lorsqu'il choisira son pays, on lui mettra ici son currency correspondant
  currency             String   @default("nothing")
  //
  role                 UserRole @default(USER)
  isPartner            Boolean  @default(false)
  // le maximum qu'il peut recevoir des user approvisionnant leur compte
  maxPartnerCredit     Int      @default(0)
  // ce qu'il peut actuellement encaisser des user
  partnerCredit        Int      @default(0)
  // ce que le partenaire peut remettre à un user qui recupère sa cagnotte
  partnerCreditToRemit Int      @default(0)
  //
  isActiveAccount      Boolean  @default(true)
  //
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}
//
enum UserRole {
  ADMIN
  USER
}
//
model CollectionList {
  id                 String     @id @default(auto()) @map("_id") @db.ObjectId
  ownId              Int        @default(1)
  amount             Int
  currency           String     @default("nothing")
  collectionType     String     @default("")
  isGroupComplete    Boolean    @default(false)
  // la collecte est cloturé ?
  isCollectionClosed Boolean  @default(false)
  //
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
//
model Collection {
  id                 String  @id @default(auto()) @map("_id") @db.ObjectId
  ownId              Int     @default(1)
  amount             Int
  currency           String  @default("nothing")
  collectionType     String  @default("")
  group              Int     @default(3)
  groupStatus        Int   
  // le group est complet ?
  isGroupComplete    Boolean @default(false)
  // la collecte est cloturé ?
  isCollectionClosed Boolean @default(false)
  // le participant
  email              String?
  usercodepin        Int     @default(1000)
  isOnlyDonator      Boolean @default(false)
  hasGive            Boolean @default(false) // le participant a t-il donné ?
  //
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  //
}
//
model CollectionResult {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  //code pin du donateur
  donatorcodepin    Int
  //email du donateur
  donatorEmail      String?
  // rang du donateur n° permettant de distingué chaque participant
  donatorRank       Int     @default(0)
  // own id de la collecte
  collectionOwnId   Int?
  // montant à donner dans la collecte
  amount            Int?
  // la monnaie concerné de la collecte
  currency          String @default("nothing")
  // le type de collecte
  collectionType    String @default("")
  //
  recipientcodepin  Int
  recipientEmail    String?
  //number of donations received = concerne toujours le recipient
  nuodore           Int  @default(0)
  createdAt         DateTime @default(now())
}
// les retraits demandés sur son jackpot 
model TransferDemand {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  email              String?
  usercodepin        Int      @default(1000)
  amountToTransfer   Int
  currency           String   @default("nothing")  
  transferCode       Int      @default(0)
  isUsed             Boolean  @default(false) 
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
//
model Activity {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  usercodepin    Int      @default(1000)
  activity       Json
  concerned      Json?
  action         Json?
  createdAt      DateTime @default(now())
}
//
model Amount {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  amount     Int     @default(1)
  currency   String  @default("nothing")
  rank       String  @default("nothing")
}
//
model Country {
  id               String  @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  currency         String
  usezone          String 
  profile          Profile[]
}
//

model AlreadyMeet {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  //email du connecté
  connectedEmail   String?
  connectedCodepin Int
  // email du participant déjà rencontré
  metEmail         String
  metCodepin       Int
  createdAt        DateTime @default(now())
}
// Enregistrer ici les commissions que touche l'e/se
model Commission {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userEmail         String?
  usercodepin       Int
  transferCode      Int?
  userJackpot       Int?
  amountToTransfer  Int?
  commission        Int?    @default(0)
  // cents x 100
  commissionCents   Int     @default(0)
  currency          String  @default("nothing")
  // si transfert de jackpot vers credit ou retrait
  origin            String? 
  //
  createdAt      DateTime   @default(now())
}
// taux de commission en %
model CommissionRate {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  rate           Int     @default(1)
  //
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}
//
model Cents {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  // ex: 0,57
  amount         String
  // 5
  cent1          Int     @default(0)
  // 7
  cent2          Int     @default(0)
  // multiplié par 100 = 0,57 x 100 = 57
  byten          Int
}
// ####
// TRÈS IMPORTANT
model Metric {
  id                        String  @id @default(auto()) @map("_id") @db.ObjectId
  
  currentgroup              Int  @default(3)
  currentNbrOfCollection    Int  @default(1)
  nextOwnIdSnippetToEnter   Int  @default(1)
  // next own id collection to enter
  nextOwnIdCollectionToEnter Int  @default(1)
}
//